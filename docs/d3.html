<!DOCTYPE html>
<meta charset="utf-8">
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Merriweather|Nunito"
          rel="stylesheet">
    <style>
        body {
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        section.tarefas {
            margin-top: 50px;
            border: 1px solid red;
            margin-bottom: 10px;
        }

        h1 {
            font-family: 'Merriweather', serif;
            font-size: 2em;
        }

        p {
            font-family: 'Nunito', sans-serif;
            font-size: 1.3em
        }

        #grafo {
            height: 600px;
            margin-bottom: 12px;
        }

        #grafo svg {
            border: 1px solid;
            font: 13px sans-serif;
            text-anchor: end;
        }

        #grafo .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }

        .node .selected {
            stroke: black;
        }

        .node circle {
            stroke: #fff;
            stroke-width: 1.5px;
        }

        .link line {
            stroke: gray;
            stroke-width: 2px;
        }

        .detalhes {
            margin-top: 20px;
        }
    </style>
</head>

<body>
<section class="header">
    <h1>Bacharelado em Engenharia de Software</h1>
    <p>Se você deseja conhecer este curso, então eu posso ajudar. </p>
</section>

<button type="button" onclick="redesenha()">Redesenha</button>

<div class="restricoes">
    <div class="opcoes-nos">
        <span>Nós:&nbsp;</span>
        <input type="checkbox" id="opcoes-disciplinas" checked
               onchange="opcoesDisciplinas(this)">
        <label for="opcoes-disciplinas">Disciplinas</label>

        <input type="checkbox" id="opcoes-termos" checked
               onchange="opcoesTermos(this)">
        <label for="opcoes-termos">termos</label>

        <input type="checkbox" id="opcoes-condicoes" checked
               onchange="opcoesCondicoes(this)">
        <label for="opcoes-condicoes">Condições mínimas</label>

        <input type="checkbox" id="opcoes-habilidades" checked
               onchange="opcoesHabilidades(this)">
        <label for="opcoes-habilidades">Habilidades</label>

        <input type="checkbox" id="opcoes-conteudo" checked
               onchange="opcoesConteudo(this)">
        <label for="opcoes-conteudo">Conteúdo</label>
    </div>
    <div class="opcoes-arestas">
        <span>Arestas:&nbsp;</span>
        <input type="checkbox" id="opcoes-arestas-1" checked
               onchange="opcoesConteudoUnidade(this)">
        <label for="opcoes-arestas-1">Conteúdo>termos</label>

        <input type="checkbox" id="opcoes-arestas-3" checked
               onchange="opcoesDisciplinaConteudo(this)">
        <label for="opcoes-arestas-3">Disciplinas>conteúdo</label>

        <input type="checkbox" id="opcoes-arestas-2" checked
               onchange="opcoesDisciplinaCondicaoMinima(this)">
        <label for="opcoes-arestas-2">Disciplinas>condição mínima</label>

        <input type="checkbox" id="opcoes-arestas-4" checked
               onchange="opcoesHabilidadeUnidade(this)">
        <label for="opcoes-arestas-4">Habilidade>termos</label>

        <input type="checkbox" id="opcoes-arestas-5" checked
               onchange="opcoesCondicoesUnidades(this)">
        <label for="opcoes-arestas-5">Condições mínimas>termos</label>

        <input type="checkbox" id="opcoes-arestas-6" checked
               onchange="opcoesDisciplinaDisciplina(this)">
        <label for="opcoes-arestas-6">Pré-requisitos</label>

        <input type="checkbox" id="opcoes-arestas-7" checked
               onchange="opcoesEntreCondicoes(this)">
        <label for="opcoes-arestas-7">Entre condições</label>

        <input type="checkbox" id="opcoes-arestas-8" checked
               onchange="opcoesEntreConteudos(this)">
        <label for="opcoes-arestas-8">Entre conteúdos</label>

        <input type="checkbox" id="opcoes-arestas-9" checked
               onchange="opcoesEntreHabilidades(this)">
        <label for="opcoes-arestas-9">Entre habilidades</label>
    </div>
    <div class="opcoes-extras">
        <input type="checkbox" id="nos-sem-arestas" checked
               onchange="opcoesExcluirNosSemArestas(this)">
        <label for="nos-sem-arestas">Excluir nós sem arestas</label><br>

        <label for="palavras-exigidas">Palavras exigidas:</label>
        <input type="text" id="palavras-exigidas">
    </div>
</div>
<div id="grafo">
    <svg></svg>
</div>

<div class="detalhes">
    <span id="tipo" class="tipo">o tipo</span>
    <span id="tipo-valor" class="tipo-valor">o valor do nó</span>
</div>

<section class="tarefas">
    Lista de user stories a serem implementadas, se houver ...
    <ul>
        <li>Como usuário eu quero que seja indicado o nóme do nó sob o mouse e
            as relações desse com os demais, em área
            própria, para que facilite a minha navegação pelo ppc.
        </li>
        <li>Como usuário eu quero selecionar um nó e restringir a visualização
            apenas ao subgrafo formado pelo nó
            selecionado e os adjacentes para eu compreender melhor a relação do
            nó selecionado.
        </li>
        <li>Como usuário eu quero digitar uma palavra e visualizar quais os nós
            que contém a palavra digitada para
            facilitar a localização de informação de interesse.
        </li>
        <li>Como usuário eu desejo selecionar o tipo de nó e o tipo de aresta
            exibido e, dessa forma, visualizar apenas
            o subgrafo resultante da união dos elementos selecionados.
        </li>
    </ul>
</section>

<script type="application/javascript" src="d3.js"></script>
<script type="application/javascript" src="./d3-selectable.js"></script>

<script>
    let grafo;

    function carrega(error, graph) {
        if (error) {
            alert('Ocorreu um erro ao carregar dados...');
            throw error;
        }

        grafo = graph;
        exibeGrafo(graph);
    }

    /**
     * Função que gera grafo conforme opções de seleção do usuário
     * e requisita a reapresentação do grafo.
     */
    function redesenha() {
        var filtrado = {};

        // Remove links desmarcados
        filtrado.links = grafo.links.filter(function (l) {
            return !arestasDesmarcadas.has(l.tipo);
        });

        // Remove links para os quais pelo menos um dos nós foi desmarcado
        filtrado.links = filtrado.links.filter(function (l) {
            if (nosDesmarcados.has(l.source.tipo)) {
                return false;
            }

            if (nosDesmarcados.has(l.target.tipo)) {
                return false;
            }

            return true;
        });

        // Se nós sem arestas devem ser excluídos, então apenas
        // nós ligados a arestas devem ser exibidos. Lembrar que
        // as arestas estão restritas àquelas cujos nós não foram
        // excluídos.
        if (excluirNosSemArestas) {
            var nos = new Set();
            filtrado.links.forEach(function (l) {
                nos.add(l.source);
                nos.add(l.target);
            });

            filtrado.nodes = [...nos];
        } else {
            // Remove nós desmarcados
            filtrado.nodes = grafo.nodes.filter(function (n) {
                return !nosDesmarcados.has(n.tipo);
            });
        }

        exibeGrafo(filtrado);
    }

    d3.json("d3.json", carrega);

</script>
</body>

</html>
